
{% extends 'dashboard/index.html' %}

{% block title %}Registrar Cupo{% endblock %}

{% block content %}
<!-- Button trigger modal -->
    <div>
        <button type="button" class="btn btn-info btn-l" data-toggle="modal" data-target="#exampleModalCenter">
            A単adir nuevo cupo
        </button>
        <div style="display: inline-block; margin-left: 12px;">
            <label for="">Seleccionar semana: </label>
            <input type="date">
        </div>
        <div id="deleteSuccessNotification" class="alert alert-success" role="alert" style="display: none; margin-left: 22px; width: 50%;">
            El cupo ha sido eliminado exitosamente
        </div>
    </div>
    <!-- Modal a単adir-->
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLongTitle">Seleccionar semana de ingreso</h5>
            </div>
            <div class="modal-body">
                <div style="display: inline-block; margin-left: 12px;">
                    <label for="">Seleccionar semana: </label>
                    <input type="date">
                </div>
            </div>
            <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            <form action="/agregarTicket" method="get">
                <button type="submit" class="btn btn-primary">A単adir cupo</button>
            </form>
            </div>
        </div>
        </div>
    </div>
    
<button id="borrarCupo" type="button" class="btn btn-info btn-l" data-toggle="modal" data-target="#modalDelete" style="visibility: hidden;">
    Elimnar cupo
  </button>
  <!-- Modal eliminar-->
  <div class="modal fade" id="modalDelete" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Eliminar cupos</h5>
        </div>
        <div class="modal-body">
          多Desea eliminar los cupos seleccionados?
          <input type="hidden" id="deleteTag" value="" />
        </div>
        <div class="modal-footer">
          <button id="closeDeleteModalBtn" type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          <button id="deleteModalBtn" type="button" class="btn btn-danger">Eliminar</button>
        </div>
      </div>
    </div>
  </div>
    <iframe id="calendarIframe" src="/registerCalendar" title="Calendar" style="width: 100%; height: 560px;"></iframe>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
    <script>
        
        window.addEventListener("load", () => {
        
            let calendarIframe = document.getElementById("calendarIframe");
            let deleteModalBtn = document.getElementById("deleteModalBtn");
            let closeDeleteModalBtn = document.getElementById("closeDeleteModalBtn");
            let eliminarBtns = calendarIframe.contentWindow.document.getElementsByClassName("borrarCupoBtn");

            Array.prototype.forEach.call(eliminarBtns, (btn) => {
            
                btn.addEventListener("click", (e) => { 
                
                    let target = e.target;

                    $('#borrarCupo').click();
                    $('#deleteTag').val(target.parentElement.id);

                });
        
            });
        
            deleteModalBtn.addEventListener("click", (e) => {

                let tag = calendarIframe.contentWindow.document.getElementById( 
                    $('#deleteTag').val() 
                );
                tag.remove();
                closeDeleteModalBtn.click();
                $("#deleteSuccessNotification").css("display", "inline-block");
                setTimeout(() => $("#deleteSuccessNotification").css("display", "none"), 5000);

            });
        });

    </script>
    {% if nuevo %}
        <script>
            
            window.addEventListener("load", (e) => {
                let newTag = calendarIframe.contentWindow.document.getElementById("tag7");
                
                newTag.style.display = "block";
                newTag.innerHTML = '{{ nuevo[1] }}: {{ nuevo[0] }} <i class="fas fa-edit" style="margin-left: 16px;"></i><i class="far fa-trash-alt borrarCupoBtn" style="margin-left: 6px;"></i></span>';
                newTag.getElementsByClassName("borrarCupoBtn")[0].addEventListener("click", (e) => { 
                
                    let target = e.target;

                    $('#borrarCupo').click();
                    $('#deleteTag').val(target.parentElement.id);

                });

            });
        </script>
    {% endif %}
{% endblock %}
